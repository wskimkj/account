<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê³„ì • ì¡°íšŒ Â· Account Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" type="image/x-icon" href="favicon.ico" />

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display",
        "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
    }

    body {
      margin: 0;
      padding: 24px 16px;
      background:
        radial-gradient(circle at top left, #e0f2fe 0, transparent 55%),
        radial-gradient(circle at bottom right, #f5d0fe 0, transparent 55%),
        #f3f4f6;
      color: #111827;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 980px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.96);
      backdrop-filter: blur(18px);
      border-radius: 24px;
      box-shadow:
        0 24px 60px rgba(15, 23, 42, 0.16),
        0 0 0 1px rgba(148, 163, 184, 0.25);
      padding: 20px 22px 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: calc(100vh - 48px);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 4px;
    }

    header h1 {
      font-size: 19px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      letter-spacing: -0.02em;
    }

    header h1 span.icon {
      font-size: 22px;
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.18));
    }

    .subtitle {
      font-size: 12px;
      color: #6b7280;
      margin-top: 3px;
    }

    .badge {
      font-size: 10px;
      padding: 4px 11px;
      border-radius: 999px;
      background: linear-gradient(135deg, #4f46e5, #9333ea);
      color: #f9fafb;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      box-shadow: 0 6px 16px rgba(129, 140, 248, 0.45);
      border: 1px solid rgba(129, 140, 248, 0.7);
      white-space: nowrap;
    }

    .search-section { margin-bottom: 4px; }

    .search-box {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 6px;
    }

    .search-box input {
      flex: 1;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      outline: none;
      background: #f9fafb;
      transition: border-color 0.15s, box-shadow 0.15s, background-color 0.15s, transform 0.05s;
    }

    .search-box input:focus {
      border-color: #6366f1;
      box-shadow:
        0 0 0 1px rgba(129, 140, 248, 0.55),
        0 10px 24px rgba(129, 140, 248, 0.3);
      background: #ffffff;
      transform: translateY(-0.5px);
    }

    .search-box button {
      padding: 9px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #f9fafb;
      white-space: nowrap;
      box-shadow: 0 10px 24px rgba(129, 140, 248, 0.55);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .hint {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 10px;
      align-items: center;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 9px;
      font-weight: 700;
      background: #e0ecff;
      color: #2563eb;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    /* âœ… ì˜µì…˜ í† ê¸€ UI */
    .mode-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 4px 10px rgba(148, 163, 184, 0.18);
      font-size: 11px;
      color: #4b5563;
    }
    .mode-toggle input { accent-color: #6366f1; }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #4b5563;
      margin-bottom: 4px;
    }

    .results-header span.label {
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-size: 10px;
      color: #9ca3af;
    }

    .result-list {
      flex: 1;
      max-height: calc(100vh - 240px);
      overflow-y: auto;
      padding-right: 4px;

      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }

    .row {
      background: radial-gradient(circle at top left, #eef2ff, #f9fafb 55%);
      border-radius: 16px;
      padding: 10px 11px;
      border: 1px solid rgba(226, 232, 240, 0.95);
      display: flex;
      flex-direction: column;
      gap: 7px;
      font-size: 11px;
      transition: box-shadow 0.14s ease, transform 0.08s ease, border-color 0.14s ease,
        background 0.14s ease;
      box-shadow:
        0 1px 0 rgba(255, 255, 255, 0.8),
        0 4px 10px rgba(148, 163, 184, 0.25);
    }

    .row:hover {
      box-shadow:
        0 10px 24px rgba(129, 140, 248, 0.35),
        0 0 0 1px rgba(129, 140, 248, 0.45);
      transform: translateY(-1px);
      background: radial-gradient(circle at top left, #e0e7ff, #f9fafb 60%);
    }

    .row-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .row-main { display: flex; flex-direction: column; gap: 2px; }

    .row-site {
      font-size: 13px;
      font-weight: 600;
      color: #111827;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      letter-spacing: -0.01em;
    }

    .group-badge {
      font-size: 10px;
      padding: 3px 9px;
      border-radius: 999px;
      font-weight: 600;
      border: 1px solid;
      white-space: nowrap;
      background: #f3f4f6;
    }

    .group-jh { border-color: #4f46e5; color: #4338ca; background: #eef2ff; }
    .group-nh { border-color: #16a34a; color: #15803d; background: #ecfdf3; }
    .group-hty { border-color: #d97706; color: #b45309; background: #fef3c7; }
    .group-etc { border-color: #9ca3af; color: #4b5563; background: #f3f4f6; }

    .row-body { display: flex; flex-wrap: wrap; gap: 4px 6px; }

    .field-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.98);
      border: 1px solid #e5e7eb;
      font-size: 10px;
      max-width: 100%;
      box-shadow: 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    .field-label {
      font-size: 9px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .field-value {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      font-size: 10px;
      color: #111827;
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .copy-btn {
      border: none;
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 10px;
      cursor: pointer;
      background: #f3f4f6;
      color: #4b5563;
      white-space: nowrap;
      transition: background 0.12s ease, color 0.12s ease, transform 0.05s ease;
    }

    .copy-btn:hover { background: #e5e7eb; color: #111827; }
    .copy-btn:active { transform: translateY(1px); }

    .empty {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 8px;
      padding: 8px 4px;
      grid-column: 1 / -1;
      text-align: center;
    }

    .toast {
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: #111827;
      color: white;
      padding: 7px 14px;
      border-radius: 999px;
      font-size: 11px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease-out, transform 0.18s ease-out;
      z-index: 999;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.55);
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-2px); }

    @media (max-width: 960px) { .result-list { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    @media (max-width: 720px) {
      body { padding: 16px 10px; }
      .app { padding: 16px 14px 14px; max-height: none; }
      header h1 { font-size: 17px; }
      .result-list { grid-template-columns: repeat(2, minmax(0, 1fr)); max-height: none; }
    }
    @media (max-width: 520px) { body { padding: 12px 8px; } .result-list { grid-template-columns: repeat(1, minmax(0, 1fr)); } }

    :root{ --page-pad: 18px; --page-max: 1400px; }
    html, body{ height:100%; }
    body{
      padding: var(--page-pad) !important;
      margin: 0 !important;
      display: block !important;
    }
    .container, .app-shell{
      width:100% !important;
      max-width: var(--page-max) !important;
      margin: 0 auto !important;
    }
    .card, .inner-shell{
      min-height: calc(100vh - (var(--page-pad) * 2)) !important;
      display: flex !important;
      flex-direction: column !important;
    }
    .table-wrapper, .result-card, .result-area, #tableWrapper{ flex: 1 1 auto !important; }
    .table-wrapper{ max-height: none !important; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1><span class="icon">ğŸ”‘</span><span>ê³„ì • ì¡°íšŒ</span></h1>
        <div class="subtitle"></div>
      </div>
      <div class="badge">ACCOUNT FINDER</div>
    </header>

    <section class="search-section">
      <div class="search-box">
        <input id="query" type="text" placeholder="ì˜ˆ) ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ / ì¿ íŒ¡ / 11ë²ˆê°€ ..." />
        <button id="searchBtn">ê²€ìƒ‰</button>
      </div>

      <div class="hint">
        <span class="pill">SEARCH</span>

        <!-- âœ… ì˜µì…˜: OR / AND -->
        <label class="mode-toggle" title="ê¸°ë³¸ì€ ì¼ë¶€(OR) ì¼ì¹˜, ì²´í¬í•˜ë©´ ëª¨ë“  í‚¤ì›Œë“œ(AND) ì¼ì¹˜">
          <input id="matchAll" type="checkbox" />
          ëª¨ë“  í‚¤ì›Œë“œ ì¼ì¹˜(AND)
        </label>
      </div>
    </section>

    <div class="results-header">
      <span class="label">RESULTS</span>
      <span id="result-count">0ê±´</span>
    </div>

    <div id="result-list" class="result-list"></div>
  </div>

  <div id="toast" class="toast">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤</div>

  <script>
    // -------------------------------------------------------------------
    // ğŸ”§ êµ¬ê¸€ ì‹œíŠ¸ ì„¤ì •
    // -------------------------------------------------------------------
    const SHEET_ID = "1bdGBLki_3CVaq7BDL3u-pQDSZVBD7roeEdsyP-74Lz0";

    const SHOP_GIDS = [
      0,          // ì‹œíŠ¸1 (JH)
      618725932,  // ì‹œíŠ¸2 (NH)
      1481873109  // ì‹œíŠ¸3 (HTY)
    ];

    const OTHER_GID = 267581891;

    // âœ… ì¶”ê°€ DB (ë‹¤ë¥¸ ìŠ¤í”„ë ˆë“œì‹œíŠ¸)
    const EXTRA_SHEET_ID = "1cAXTlsGoK8FNEZ-7PaR7dfLjykPfCqLOIcyBqqdu3wY";
    const EXTRA_GID = 1617573679;

    let SHOP_SITES = [];
    let OTHER_SITES = [];
    let EXTRA_SITES = []; // âœ… ì¶”ê°€DB
    let dataLoaded = false;

    const queryInput = document.getElementById("query");
    const searchBtn = document.getElementById("searchBtn");
    const resultList = document.getElementById("result-list");
    const resultCount = document.getElementById("result-count");
    const toast = document.getElementById("toast");
    const matchAllToggle = document.getElementById("matchAll");

    // -------------------------------------------------------------------
    // CSV ë¶ˆëŸ¬ì˜¤ê¸° & íŒŒì‹±
    // -------------------------------------------------------------------
    function csvUrl(sheetId, gid) {
      return `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;
    }

    async function fetchCsv(sheetId, gid) {
      const res = await fetch(csvUrl(sheetId, gid));
      const text = await res.text();
      return parseCsv(text);
    }

    // âœ… ë”°ì˜´í‘œ/ì½¤ë§ˆ í¬í•¨ CSV íŒŒì„œ (êµ¬ê¸€ì‹œíŠ¸ CSVì— ì í•©)
    function parseCsv(text) {
      const rows = [];
      let row = [];
      let cur = "";
      let inQuotes = false;

      // \r\n / \n ëª¨ë‘ ëŒ€ì‘
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        const next = text[i + 1];

        if (ch === '"' ) {
          if (inQuotes && next === '"') { // escaped quote
            cur += '"';
            i++;
          } else {
            inQuotes = !inQuotes;
          }
          continue;
        }

        if (!inQuotes && ch === ",") {
          row.push(cur);
          cur = "";
          continue;
        }

        if (!inQuotes && (ch === "\n" || ch === "\r")) {
          if (ch === "\r" && next === "\n") i++;
          row.push(cur);
          // ë¹ˆ ì¤„ ì œê±° (ëª¨ë“  ì»¬ëŸ¼ ë¹ˆê°’ì´ë©´ ìŠ¤í‚µ)
          if (row.some(c => (c || "").toString().trim() !== "")) rows.push(row);
          row = [];
          cur = "";
          continue;
        }

        cur += ch;
      }

      // last cell
      if (cur.length > 0 || row.length > 0) {
        row.push(cur);
        if (row.some(c => (c || "").toString().trim() !== "")) rows.push(row);
      }

      return rows;
    }

    // -------------------------------------------------------------------
    // âœ… AG í‚¤ì›Œë“œ í† í°í™”
    // - "ë‹¨ì–´, ë‹¨ì–´" í˜•íƒœë¥¼ ì½¤ë§ˆë¡œ ìª¼ê°œì„œ ë°°ì—´ë¡œ ì €ì¥
    // -------------------------------------------------------------------
    function splitAgKeywords(agCellValue) {
      return (agCellValue || "")
        .toString()
        .split(",")
        .map(s => s.trim())
        .filter(Boolean);
    }

    // âœ… ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê²€ìƒ‰ì–´ë„ í‚¤ì›Œë“œë¡œ ìª¼ê°œê¸°
    // - ì½¤ë§ˆ/ê³µë°± ì—°ì† êµ¬ë¶„ì ì²˜ë¦¬
    function splitQueryKeywords(query) {
      return (query || "")
        .toString()
        .split(/[,\s]+/g)
        .map(s => s.trim())
        .filter(Boolean);
    }

    // -------------------------------------------------------------------
    // ğŸ”¥ Aì—´ì´ 'ë§¤ì¥'ì¸ í–‰ì€ ì „ì²´ ì œì™¸ (ëª¨ë“  ì‹œíŠ¸ ê³µí†µ)
    // -------------------------------------------------------------------
    async function loadData() {
      resultList.innerHTML = '<div class="empty">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
      resultCount.textContent = "";

      try {
        // -------- 1) ì‡¼í•‘ëª° 3ê°œ ì‹œíŠ¸ --------
        const shopPromises = SHOP_GIDS.map(gid => fetchCsv(SHEET_ID, gid));
        const shopSheetsRows = await Promise.all(shopPromises);

        SHOP_SITES = [];

        shopSheetsRows.forEach((rows, idx) => {
          const gid = SHOP_GIDS[idx];
          if (!rows || rows.length <= 1) return;

          let groupLabel = "";
          if (gid === 0) groupLabel = "JH";
          else if (gid === 618725932) groupLabel = "NH";
          else if (gid === 1481873109) groupLabel = "HTY";
          else groupLabel = "ê¸°íƒ€";

          rows.slice(1).forEach(cols => {
            const colA = (cols[0] || "").toString().trim();
            if (colA === "ë§¤ì¥") return;

            // ì‡¼í•‘ëª°ëª… AGì—´ (index 32)
            const ag = cols[32] || "";
            const agKeywords = splitAgKeywords(ag);
            if (!agKeywords.length) return;

            let storeId = "";
            let loginId = "";
            let pw = "";

            if (gid === 0) {
              // ì‹œíŠ¸1: ìƒì ID N(13), ID O(14), PW P(15)
              storeId = cols[13];
              loginId = cols[14];
              pw      = cols[15];
            } else if (gid === 618725932) {
              // âœ… ì‹œíŠ¸2: ìƒì ID N(13), ID O(14), PW P(15)
              storeId = cols[13];
              loginId = cols[14];
              pw      = cols[15];
            } else if (gid === 1481873109) {
              // ì‹œíŠ¸3: ìƒì ID M(12), ID N(13), PW O(14)
              storeId = cols[12];
              loginId = cols[13];
              pw      = cols[14];
            }

            // í‘œì‹œìš© siteNameì€ ì›ë³¸ AG ë¬¸ìì—´ ê·¸ëŒ€ë¡œ ë‘ë˜,
            // ê²€ìƒ‰ì€ agKeywords(í† í°)ë¡œ ì²˜ë¦¬
            SHOP_SITES.push({
              group: groupLabel,
              siteName: ag || "",
              agKeywords,                 // âœ… ê²€ìƒ‰ìš© í† í°
              storeId: storeId || "",
              loginId: loginId || "",
              pw: pw || ""
            });
          });
        });

        // -------- 2) ê¸°íƒ€ ì‹œíŠ¸ --------
        OTHER_SITES = [];
        if (OTHER_GID != null) {
          const otherRows = await fetchCsv(SHEET_ID, OTHER_GID);
          if (otherRows.length > 1) {
            otherRows.slice(1).forEach(cols => {
              const colA = (cols[0] || "").toString().trim();
              if (colA === "ë§¤ì¥") return;

              const siteName = cols[0]; // A
              const loginId  = cols[3]; // D
              const pw       = cols[4]; // E
              if (!siteName) return;

              OTHER_SITES.push({
                group: "ê¸°íƒ€",
                siteName: siteName || "",
                // ê¸°íƒ€ëŠ” ì½¤ë§ˆ í‚¤ì›Œë“œ ê·œì¹™ì„ ë™ì¼ ì ìš© (ì›í•˜ë©´ ì œê±° ê°€ëŠ¥)
                agKeywords: splitAgKeywords(siteName),
                loginId: loginId || "",
                pw: pw || ""
              });
            });
          }
        }

        // -------- 3) âœ… ì¶”ê°€ DB (ì „ì²´ ì…€ ê¸°ì¤€ ê²€ìƒ‰ / H=ID, I=PW) --------
        EXTRA_SITES = [];
        try {
          const extraRows = await fetchCsv(EXTRA_SHEET_ID, EXTRA_GID);
          if (extraRows && extraRows.length > 1) {
            extraRows.slice(1).forEach(cols => {
              if (!cols || !cols.some(c => (c || "").toString().trim() !== "")) return;

              // ì „ì²´ ì…€ í…ìŠ¤íŠ¸ë¡œ ê²€ìƒ‰
              const searchText = cols.map(c => (c || "").toString()).join(" ");

              // Hì—´(7)=ID, Iì—´(8)=PW
              const loginId = cols[7] || "";
              const pw      = cols[8] || "";

              // ì¹´ë“œ ì œëª©(í‘œì‹œìš©) - ê¸°ë³¸ì€ Aì—´, ì—†ìœ¼ë©´ "(ì¶”ê°€DB)"
              const siteName = (cols[0] || "").toString().trim() || "(ì¶”ê°€DB)";

              EXTRA_SITES.push({
                group: "ì¶”ê°€DB",
                siteName,
                searchText,
                loginId: loginId || "",
                pw: pw || ""
              });
            });
          }
        } catch (e) {
          console.error("ì¶”ê°€ DB ë¡œë”© ì‹¤íŒ¨:", e);
        }

        dataLoaded = true;
        resultList.innerHTML = '<div class="empty"></div>';
        resultCount.textContent = "0ê±´";
      } catch (e) {
        console.error(e);
        resultList.innerHTML =
          '<div class="empty">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì‹œíŠ¸ ê³µê°œ ê¶Œí•œ í™•ì¸ í•„ìš”)</div>';
      }
    }

    // -------------------------------------------------------------------
    // ê²€ìƒ‰ ë¡œì§
    // - ê¸°ë³¸(OR): ì¼ë¶€ í‚¤ì›Œë“œë¼ë„ ë§¤ì¹­
    // - ì˜µì…˜(AND): ëª¨ë“  í‚¤ì›Œë“œ ë§¤ì¹­
    // -------------------------------------------------------------------
    function normalize(str) {
      return (str || "").toString().toLowerCase().trim();
    }

    // "í† í°ë“¤" ì¤‘ì— queryTokenì´ í¬í•¨ë˜ëŠ”ì§€ (ë¶€ë¶„ì¼ì¹˜) - ì‡¼í•‘/ê¸°íƒ€ í† í° ê¸°ë°˜
    function tokenMatchAny(agTokens, queryTokens) {
      const a = (agTokens || []).map(normalize).filter(Boolean);
      const q = (queryTokens || []).map(normalize).filter(Boolean);
      if (!a.length || !q.length) return false;

      // OR: queryTokens ì¤‘ í•˜ë‚˜ë¼ë„ agTokens ì¤‘ í•˜ë‚˜ì— í¬í•¨ë˜ë©´ true
      return q.some(qt => a.some(at => at.includes(qt)));
    }

    function tokenMatchAll(agTokens, queryTokens) {
      const a = (agTokens || []).map(normalize).filter(Boolean);
      const q = (queryTokens || []).map(normalize).filter(Boolean);
      if (!a.length || !q.length) return false;

      // AND: ëª¨ë“  queryTokenì´ agTokens ì–´ë”˜ê°€ì— í¬í•¨ë˜ì–´ì•¼ true
      return q.every(qt => a.some(at => at.includes(qt)));
    }

    // âœ… ì¶”ê°€DB: ì „ì²´ ì…€ í…ìŠ¤íŠ¸ ê¸°ì¤€
    function textMatchAny(text, queryTokens) {
      const t = normalize(text);
      const q = (queryTokens || []).map(normalize).filter(Boolean);
      if (!t || !q.length) return false;
      return q.some(qt => t.includes(qt));
    }

    function textMatchAll(text, queryTokens) {
      const t = normalize(text);
      const q = (queryTokens || []).map(normalize).filter(Boolean);
      if (!t || !q.length) return false;
      return q.every(qt => t.includes(qt));
    }

    function searchSites(query, matchAll) {
      const queryTokens = splitQueryKeywords(query);
      if (!queryTokens.length) return [];

      const results = [];

      const tokenMatcher = matchAll ? tokenMatchAll : tokenMatchAny;

      SHOP_SITES.forEach(item => {
        if (tokenMatcher(item.agKeywords, queryTokens)) {
          results.push({
            group: item.group || "ê¸°íƒ€",
            siteName: item.siteName || "",
            storeId: item.storeId || "",
            loginId: item.loginId || "",
            pw: item.pw || ""
          });
        }
      });

      OTHER_SITES.forEach(item => {
        if (tokenMatcher(item.agKeywords, queryTokens)) {
          results.push({
            group: item.group || "ê¸°íƒ€",
            siteName: item.siteName || "",
            storeId: "",
            loginId: item.loginId || "",
            pw: item.pw || ""
          });
        }
      });

      // âœ… ì¶”ê°€DB ê²€ìƒ‰(ì „ì²´ ì…€ ê¸°ì¤€)
      const textMatcher = matchAll ? textMatchAll : textMatchAny;
      EXTRA_SITES.forEach(item => {
        if (textMatcher(item.searchText, queryTokens)) {
          results.push({
            group: item.group || "ê¸°íƒ€",
            siteName: item.siteName || "",
            storeId: "",
            loginId: item.loginId || "",
            pw: item.pw || ""
          });
        }
      });

      results.sort((a, b) => (a.siteName || "").localeCompare(b.siteName || ""));
      return results;
    }

    // -------------------------------------------------------------------
    // ë Œë”ë§
    // -------------------------------------------------------------------
    function renderResults(results) {
      if (!results || results.length === 0) {
        resultList.innerHTML = '<div class="empty">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        resultCount.textContent = "0ê±´";
        return;
      }

      resultCount.textContent = results.length + "ê±´";
      const frag = document.createDocumentFragment();

      results.forEach(item => {
        const row = document.createElement("div");
        row.className = "row";

        const header = document.createElement("div");
        header.className = "row-header";

        const main = document.createElement("div");
        main.className = "row-main";

        const siteEl = document.createElement("div");
        siteEl.className = "row-site";
        siteEl.textContent = item.siteName || "(ì‚¬ì´íŠ¸ëª… ì—†ìŒ)";

        main.appendChild(siteEl);

        const groupWrap = document.createElement("div");
        const group = (item.group || "ê¸°íƒ€").toUpperCase();
        const badge = document.createElement("span");
        badge.className =
          "group-badge " +
          (group === "JH"
            ? "group-jh"
            : group === "NH"
            ? "group-nh"
            : group === "HTY"
            ? "group-hty"
            : "group-etc");
        badge.textContent = group;
        groupWrap.appendChild(badge);

        header.appendChild(main);
        header.appendChild(groupWrap);
        row.appendChild(header);

        const body = document.createElement("div");
        body.className = "row-body";

        const store = (item.storeId || "").toString().trim();
        const hasStore = store !== "" && store !== "-" && store !== "ì—†ìŒ";

        if (hasStore) body.appendChild(makeFieldChip("ìƒì ", item.storeId));
        if (item.loginId) body.appendChild(makeFieldChip("ID", item.loginId));
        if (item.pw) body.appendChild(makeFieldChip("PW", item.pw));

        row.appendChild(body);
        frag.appendChild(row);
      });

      resultList.innerHTML = "";
      resultList.appendChild(frag);
    }

    function makeFieldChip(label, value) {
      const chip = document.createElement("div");
      chip.className = "field-chip";

      const labelEl = document.createElement("div");
      labelEl.className = "field-label";
      labelEl.textContent = label;

      const valueEl = document.createElement("div");
      valueEl.className = "field-value";
      valueEl.textContent = value;

      const btn = document.createElement("button");
      btn.className = "copy-btn";
      btn.type = "button";
      btn.textContent = "ë³µì‚¬";
      btn.addEventListener("click", () => copyToClipboard(value));

      chip.appendChild(labelEl);
      chip.appendChild(valueEl);
      chip.appendChild(btn);

      return chip;
    }

    function copyToClipboard(text) {
      if (!text) return;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(showToast);
      } else {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand("copy");
          showToast();
        } catch (e) {
          alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ì„ íƒí•´ì„œ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
        }
        document.body.removeChild(textarea);
      }
    }

    let toastTimer = null;
    function showToast() {
      toast.classList.add("show");
      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(() => {
        toast.classList.remove("show");
      }, 1200);
    }

    function doSearch() {
      if (!dataLoaded) {
        resultList.innerHTML =
          '<div class="empty">ì•„ì§ ë°ì´í„° ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
        resultCount.textContent = "";
        return;
      }
      const q = queryInput.value.trim();
      const matchAll = !!matchAllToggle.checked;
      const results = searchSites(q, matchAll);
      renderResults(results);
    }

    queryInput.addEventListener("keydown", e => {
      if (e.key === "Enter") doSearch();
    });

    searchBtn.addEventListener("click", doSearch);

    // âœ… ì˜µì…˜ ë°”ë€Œë©´ ì¦‰ì‹œ ì¬ê²€ìƒ‰ (ì…ë ¥ê°’ì´ ìˆìœ¼ë©´)
    matchAllToggle.addEventListener("change", () => {
      if (queryInput.value.trim()) doSearch();
    });

    window.onload = () => {
      queryInput.focus();
      loadData();
    };
  </script>
</body>
</html>
